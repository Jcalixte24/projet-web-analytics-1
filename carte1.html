<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Carte Mondiale des Salaires Tech - Analyse Globale</title>
  <link rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/512/3135/3135706.png" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/plotly.js/2.26.0/plotly.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }

    .container {
      max-width: 1600px;
      margin: 0 auto;
      background-color: white;
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    }

    .navigation {
      text-align: center;
      margin-bottom: 30px;
      padding: 20px;
      background: rgba(102, 126, 234, 0.1);
      border-radius: 10px;
    }

    .nav-button {
      display: inline-block;
      background: rgba(102, 126, 234, 0.2);
      color: #667eea;
      padding: 12px 24px;
      text-decoration: none;
      border-radius: 8px;
      font-weight: 600;
      margin: 0 10px;
      transition: all 0.3s ease;
      border: 2px solid transparent;
    }

    .nav-button:hover,
    .nav-button.active {
      background: #667eea;
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
    }

    h1 {
      color: #333;
      text-align: center;
      font-size: 2.5rem;
      margin-bottom: 10px;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
    }

    .subtitle {
      text-align: center;
      color: #666;
      font-size: 1.2rem;
      margin-bottom: 30px;
      font-style: italic;
    }

    .controls {
      margin: 20px 0;
      padding: 15px;
      background-color: #f9f9f9;
      border-radius: 5px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
    }

    .control-group {
      margin: 0;
    }

    label {
      display: block;
      font-weight: bold;
      margin-bottom: 5px;
      color: #555;
    }

    select {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
    }

    #map {
      width: 100%;
      height: 700px;
    }

    .info {
      margin-top: 20px;
      padding: 20px;
      background: linear-gradient(135deg, #e3f2fd, #f3e5f5);
      border-left: 5px solid #667eea;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .footer {
      background: rgba(102, 126, 234, 0.1);
      color: #333;
      text-align: center;
      padding: 30px;
      border-radius: 15px;
      margin-top: 40px;
    }

    .footer p {
      margin-bottom: 10px;
    }

    .footer a {
      color: #667eea;
      text-decoration: none;
      font-weight: 600;
    }

    .footer a:hover {
      text-decoration: underline;
    }

    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }

    .stat-card {
      background-color: #f5f5f5;
      padding: 15px;
      border-radius: 5px;
      text-align: center;
    }

    .stat-value {
      font-size: 24px;
      font-weight: bold;
      color: #2196F3;
    }

    .stat-label {
      font-size: 14px;
      color: #666;
      margin-top: 5px;
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="navigation">
      <a href="index.html" class="nav-button"> Accueil</a>
      <a href="page_age.html" class="nav-button">√Çge</a>
      <a href="page_formation.html" class="nav-button">Formation</a>
      <a href="page_metiers.html" class="nav-button">M√©tiers</a>
      <a href="page_entreprise.html" class="nav-button">Entreprise</a>
      <a href="page_geographie.html" class="nav-button">G√©ographie</a>
      <a href="page_genre.html" class="nav-button">Genre</a>
      <a href="carte1.html" class="nav-button active"> Carte Mondiale</a>
    </div>

    <h1>üåç Carte Mondiale des Salaires Tech</h1>
    <div class="subtitle">Analyse g√©ographique globale des r√©mun√©rations dans le secteur technologique</div>

    <div class="controls">
      <div class="control-group">
        <label for="yearSelect"> Ann√©e :</label>
        <select id="yearSelect">
          <option value="all">Toutes les ann√©es</option>
        </select>
      </div>

      <div class="control-group">
        <label for="categorySelect"> Cat√©gorie de poste :</label>
        <select id="categorySelect">
          <option value="all">Toutes les cat√©gories</option>
        </select>
      </div>

      <div class="control-group">
        <label for="experienceSelect"> Niveau d'exp√©rience :</label>
        <select id="experienceSelect">
          <option value="all">Tous les niveaux</option>
        </select>
      </div>
    </div>

    <div id="map"></div>

    <div class="stats" id="stats"></div>

    <div class="info">
      <strong>üåç Carte Mondiale Interactive :</strong> Cette visualisation pr√©sente une analyse g√©ographique compl√®te
      des salaires dans le secteur technologique √† l'√©chelle mondiale.
      La carte affiche la moyenne des salaires en USD par pays, avec un d√©grad√© de couleurs allant du clair au fonc√©
      selon le niveau de r√©mun√©ration.
      Survolez un pays pour voir les d√©tails complets incluant le nombre d'emplois et le salaire moyen sp√©cifique.
      <br><br>
      <strong> Focus Tech :</strong> Les donn√©es proviennent exclusivement du secteur "Information et communication" et
      incluent tous les m√©tiers tech :
      d√©veloppeurs, data scientists, DevOps, cybers√©curit√©, et autres professions technologiques.
    </div>

    <div class="footer">
      <p><strong> Analyse G√©ographique Mondiale - Secteur Tech 2025</strong></p>
      <p>Donn√©es sources : <a href="https://www.insee.fr" target="_blank">INSEE</a> | DADS 2021 - Secteur "Information
        et communication"</p>
      <p>D√©velopp√© avec <a href="https://plotly.com/javascript/" target="_blank">Plotly.js</a> et technologies web
        modernes</p>
    </div>
  </div>

  <script>
    let rawData = [];
    let currentFilters = {
      year: 'all',
      category: 'all',
      experience: 'all'
    };

    // Charger le fichier CSV
    Papa.parse('salaries_fulltime_only.csv', {
      download: true,
      header: true,
      dynamicTyping: true,
      skipEmptyLines: true,
      complete: function (results) {
        rawData = results.data;
        initializeFilters();
        updateMap();
      },
      error: function (error) {
        console.error('Erreur de chargement du CSV:', error);
        document.getElementById('map').innerHTML =
          '<div style="color: red; padding: 20px;">Erreur de chargement du fichier CSV. Assurez-vous que "salaries_fulltime_only.csv" est dans le m√™me dossier.</div>';
      }
    });

    function initializeFilters() {
      // Extraire les valeurs uniques pour chaque filtre
      const years = [...new Set(rawData.map(d => d.work_year))].sort((a, b) => b - a);
      const categories = [...new Set(rawData.map(d => d.job_category))].filter(c => c).sort();
      const experiences = [...new Set(rawData.map(d => d.experience_level))].filter(e => e).sort();

      // Peupler les selects
      const yearSelect = document.getElementById('yearSelect');
      years.forEach(year => {
        const option = document.createElement('option');
        option.value = year;
        option.textContent = year;
        yearSelect.appendChild(option);
      });

      const categorySelect = document.getElementById('categorySelect');
      categories.forEach(cat => {
        const option = document.createElement('option');
        option.value = cat;
        option.textContent = cat;
        categorySelect.appendChild(option);
      });

      const experienceSelect = document.getElementById('experienceSelect');
      const experienceLabels = {
        'EN': 'Entry Level (EN)',
        'MI': 'Mid Level (MI)',
        'SE': 'Senior (SE)',
        'EX': 'Executive (EX)'
      };
      experiences.forEach(exp => {
        const option = document.createElement('option');
        option.value = exp;
        option.textContent = experienceLabels[exp] || exp;
        experienceSelect.appendChild(option);
      });

      // Ajouter les listeners
      yearSelect.addEventListener('change', (e) => {
        currentFilters.year = e.target.value;
        updateMap();
      });

      categorySelect.addEventListener('change', (e) => {
        currentFilters.category = e.target.value;
        updateMap();
      });

      experienceSelect.addEventListener('change', (e) => {
        currentFilters.experience = e.target.value;
        updateMap();
      });
    }

    function updateMap() {
      // Filtrer les donn√©es
      let filteredData = rawData.filter(d => {
        if (currentFilters.year !== 'all' && d.work_year != currentFilters.year) return false;
        if (currentFilters.category !== 'all' && d.job_category !== currentFilters.category) return false;
        if (currentFilters.experience !== 'all' && d.experience_level !== currentFilters.experience) return false;
        return d.company_location && d.salary_in_usd;
      });

      // Calculer la moyenne par pays
      const salaryByCountry = {};
      filteredData.forEach(d => {
        const country = d.company_location;
        if (!salaryByCountry[country]) {
          salaryByCountry[country] = { total: 0, count: 0 };
        }
        salaryByCountry[country].total += d.salary_in_usd;
        salaryByCountry[country].count += 1;
      });

      // Pr√©parer les donn√©es pour la carte
      const countries = Object.keys(salaryByCountry);
      const averages = countries.map(country =>
        Math.round(salaryByCountry[country].total / salaryByCountry[country].count)
      );
      const counts = countries.map(country => salaryByCountry[country].count);

      // Cr√©er la carte choropl√®the
      const trace = {
        type: 'choropleth',
        locationmode: 'ISO-3',
        locations: countries,
        z: averages,
        text: countries.map((country, i) =>
          `${country}: ${averages[i].toLocaleString('fr-FR')} USD (${counts[i]} emploi${counts[i] > 1 ? 's' : ''})`
        ),
        colorscale: [
          [0, '#fee5d9'],
          [0.2, '#fcae91'],
          [0.4, '#fb6a4a'],
          [0.6, '#de2d26'],
          [0.8, '#a50f15'],
          [1, '#67000d']
        ],
        autocolorscale: false,
        reversescale: false,
        marker: {
          line: {
            color: 'rgb(255,255,255)',
            width: 0.5
          }
        },
        colorbar: {
          title: {
            text: 'Salaire Moyen<br>(USD)',
            side: 'right'
          },
          tickformat: ',.0f',
          thickness: 20
        },
        hovertemplate: '<b>%{text}</b><br>Salaire moyen: %{z:,.0f} USD<extra></extra>'
      };

      const layout = {
        title: {
          text: 'Salaire Moyen par Pays (en USD)',
          font: { size: 20 }
        },
        geo: {
          projection: {
            type: 'natural earth'
          },
          showframe: false,
          showcoastlines: true,
          showcountries: true
        },
        height: 700,
        margin: {
          t: 50,
          b: 0,
          l: 0,
          r: 0
        }
      };

      const config = {
        responsive: true,
        displayModeBar: true,
        displaylogo: false,
        modeBarButtonsToRemove: ['lasso2d', 'select2d']
      };

      Plotly.newPlot('map', [trace], layout, config);

      // Mettre √† jour les statistiques
      updateStats(filteredData, salaryByCountry);
    }

    function updateStats(filteredData, salaryByCountry) {
      const totalEmployees = filteredData.length;
      const totalCountries = Object.keys(salaryByCountry).length;
      const avgSalary = totalEmployees > 0
        ? Math.round(filteredData.reduce((sum, d) => sum + d.salary_in_usd, 0) / totalEmployees)
        : 0;

      const salaries = filteredData.map(d => d.salary_in_usd).sort((a, b) => a - b);
      const medianSalary = salaries.length > 0
        ? salaries[Math.floor(salaries.length / 2)]
        : 0;

      const statsHTML = `
                <div class="stat-card">
                    <div class="stat-value">${totalEmployees.toLocaleString('fr-FR')}</div>
                    <div class="stat-label">Employ√©s</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${totalCountries}</div>
                    <div class="stat-label">Pays</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${avgSalary.toLocaleString('fr-FR')} $</div>
                    <div class="stat-label">Salaire Moyen</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${medianSalary.toLocaleString('fr-FR')} $</div>
                    <div class="stat-label">Salaire M√©dian</div>
                </div>
            `;

      document.getElementById('stats').innerHTML = statsHTML;
    }
  </script>
</body>

</html>